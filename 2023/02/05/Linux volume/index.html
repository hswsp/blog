<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/profile.jpeg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Starry"><meta name="keywords" content=""><meta name="description" content="Linux 物理卷(PV)、逻辑卷(LV)、卷组(VG)管理"><meta property="og:type" content="article"><meta property="og:title" content="Linux 物理卷(PV)、逻辑卷(LV)、卷组(VG)管理"><meta property="og:url" content="https://umnchampagne.top/2023/02/05/Linux%20volume/index.html"><meta property="og:site_name" content="champagne&#39;s vicissitude"><meta property="og:description" content="Linux 物理卷(PV)、逻辑卷(LV)、卷组(VG)管理"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://th.bing.com/th/id/OIP.H4K60A-qLHxpph_X-2rJ9AHaE8?pid=ImgDet&rs=1"><meta property="article:published_time" content="2023-02-05T15:02:12.000Z"><meta property="article:modified_time" content="2023-02-05T15:23:34.752Z"><meta property="article:author" content="Champagne"><meta property="article:tag" content="Operating System"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://th.bing.com/th/id/OIP.H4K60A-qLHxpph_X-2rJ9AHaE8?pid=ImgDet&rs=1"><title>Linux 物理卷(PV)、逻辑卷(LV)、卷组(VG)管理 - champagne&#39;s vicissitude</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3619942_p0ons582io9.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/toubudaziji.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/daziyanse.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/gundongtiao.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"umnchampagne.top",root:"/",version:"1.9.2",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.2.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Starry</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> Home</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> Archives</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> Categories</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> Tags</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> About</a></li><li class="nav-item"><a class="nav-link" href="/Repositories/"><i class="iconfont icon-github-fill"></i> Repositories</a></li><li class="nav-item"><a class="nav-link" href="/gallery/"><i class="iconfont icon-image"></i> Galleries</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> Links</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://img.zcool.cn/community/015794554207f50000019ae939b931.jpg@1280w_1l_2o_100sh.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Linux 物理卷(PV)、逻辑卷(LV)、卷组(VG)管理"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-02-05 23:02" pubdate>February 5, 2023 pm</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 8k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 67 mins</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Linux 物理卷(PV)、逻辑卷(LV)、卷组(VG)管理</h1><div class="markdown-body"><h1 id="相关概念"><strong>相关概念</strong></h1><p>逻辑卷是使用逻辑卷组管理(Logic Volume Manager)创建出来的设备，如果要了解逻辑卷，那么首先需要了解逻辑卷管理中的一些概念。</p><ul><li>物理卷（Physical Volume,PV）：也就是物理磁盘分区，如果想要使用LVM来管理这个分区，可以使用fdisk将其ID改为LVM可以识别的值，即8e。</li><li>卷组（Volume Group,VG）：PV的集合</li><li>逻辑卷（Logic Volume,LV）：VG中画出来的一块逻辑磁盘</li></ul><p>了解概念之后，逻辑卷是如何产生的就很清晰了：物理磁盘或者磁盘分区转换为物理卷，一个或多个物理卷聚集形成一个或多个卷组，而逻辑卷就是从某个卷组里面抽象出来的一块磁盘空间。具体架构如下：</p><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/823295/202005/823295-20200513231715436-764135301.png"><img src="https://cdn.jsdelivr.net/gh/hswsp/IMAGE_HOST@main/img/823295-20200513231716132-1122001253.png" srcset="/img/loading.gif" lazyload alt="clipboard"></a></p><h1 id="为什么要使用逻辑卷"><strong>为什么要使用逻辑卷</strong></h1><p>对于物理磁盘，我们直接分区、格式化为文件系统之后就可以使用，那为什么还需要使用逻辑卷的方式来管理磁盘呢？我认为主要有2个原因：</p><ul><li>业务上使用大容量的磁盘。举个例子，我们需要在/data下挂载30TB的存储，对于单个磁盘，是无法满足要求的，因为市面上没有那么大的单块磁盘。但是如果我们使用逻辑卷，将多个小容量的磁盘聚合为一个大的逻辑磁盘，就能满足需求。</li><li>扩展和收缩磁盘。在业务初期规划磁盘时，我们并不能完全知道需要分配多少磁盘空间是合理的，如果使用物理卷，后期无法扩展和收缩，如果使用逻辑卷，可以根据后期的需求量，手动扩展或收缩。</li></ul><h1 id="创建物理卷pv"><strong>创建物理卷（PV）</strong></h1><p>通过上面的逻辑卷架构图，可以知道，如果要创建逻辑卷，需要先有物理磁盘或者磁盘分区，然后使用物理磁盘或磁盘分区创建物理卷，再使用物理卷创建卷组，最后使用卷组创建逻辑卷。接下来一步一步创建逻辑卷。</p><p>创建物理卷是创建逻辑卷的第一步，创建物理卷相关命令有：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pvcreate用于创建物理卷</span><br>pvcreate /dev/sdb<br><br><span class="hljs-comment"># pvdisplay、pvsca、pvs用于查看物理卷</span><br>pvdisplay<br>pvs<br>pvscan<br></code></pre></td></tr></table></figure><p>可以使用磁盘直接创建物理卷，也可以使用磁盘分区创建物理卷。两种方法稍微有些差距，下面进行说明。</p><h2 id="使用磁盘直接创建物理卷"><strong>使用磁盘直接创建物理卷</strong></h2><p>直接使用物理磁盘创建物理卷没有什么需要特别注意的，直接创建即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用fdisk -l确认磁盘，可以看到/dev/sdb未做分区处理</span><br>[root@masterdb ~]<span class="hljs-comment"># fdisk -l /dev/sdb</span><br><br>Disk /dev/sdb: 2147 MB, 2147483648 bytes, 4194304 sectors<br>Units = sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br><br><span class="hljs-comment"># 使用pvcreate将sdb磁盘创建为物理卷</span><br>[root@masterdb ~]<span class="hljs-comment"># pvcreate /dev/sdb</span><br>  Physical volume <span class="hljs-string">&quot;/dev/sdb&quot;</span> successfully created.<br><br><span class="hljs-comment"># 使用pvdisplay确认物理卷信息</span><br>[root@masterdb ~]<span class="hljs-comment"># pvdisplay </span><br>  --- Physical volume ---<br>  PV Name               /dev/sda3<br>  VG Name               centos<br>  PV Size               &lt;68.73 GiB / not usable 4.00 MiB<br>  Allocatable           <span class="hljs-built_in">yes</span> (but full)<br>  PE Size               4.00 MiB<br>  Total PE              17593<br>  Free PE               0<br>  Allocated PE          17593<br>  PV UUID               FRxq7G-1XWu-dPeW-wEwO-322y-M9XR-0ExebA<br>   <br>  <span class="hljs-string">&quot;/dev/sdb&quot;</span> is a new physical volume of <span class="hljs-string">&quot;2.00 GiB&quot;</span><br>  --- NEW Physical volume ---<br>  PV Name               /dev/sdb<br>  VG Name               <br>  PV Size               2.00 GiB<br>  Allocatable           NO<br>  PE Size               0   <br>  Total PE              0<br>  Free PE               0<br>  Allocated PE          0<br>  PV UUID               nsL75f-o3fD-apyz-SSY0-miUi-4RYf-zVLIT6<br>   <br><span class="hljs-comment"># 也可以使用pvs确认物理卷信息,不过能够看到的信息比pvdisplay少</span><br>[root@masterdb ~]<span class="hljs-comment"># pvs </span><br>  PV         VG     Fmt  Attr PSize  PFree<br>  /dev/sda3  centos lvm2 a--  68.72g    0 <br>  /dev/sdb          lvm2 ---   2.00g 2.00g<br>[root@masterdb ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h2 id="使用磁盘分区创建物理卷"><strong>使用磁盘分区创建物理卷</strong></h2><p>磁盘分区之后，磁盘id为83，如果要使用逻辑卷管理，需要将id改为8e，才能创建物理卷。</p><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/823295/202005/823295-20200513231716700-400843767.png"><img src="https://cdn.jsdelivr.net/gh/hswsp/IMAGE_HOST@main/img/823295-20200513231717020-1298850562.png" srcset="/img/loading.gif" lazyload alt="image"></a></p><p>分区1修改id过程如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@masterdb ~]<span class="hljs-comment"># fdisk /dev/sdc </span><br> Welcome to fdisk (util-linux 2.23.2).<br><br>Changes will remain <span class="hljs-keyword">in</span> memory only, until you decide to write them.<br> Be careful before using the write <span class="hljs-built_in">command</span>.<br><br><br> Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): t     <span class="hljs-comment">#t可以修改分区代码</span><br> Partition number (1,2, default 2): 1            <span class="hljs-comment">#选择1分区进行修改</span><br> Hex code (<span class="hljs-built_in">type</span> L to list all codes): L          <span class="hljs-comment">#如果不知道类型，可以用”L”列出可以选择的修改代码</span><br><br>  0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris        <br>  1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-<br>  2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-<br>  3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-<br>  4  FAT16 &lt;32M      40  Venix 80286     85  Linux extended  c7  Syrinx         <br>  5  Extended        41  PPC PReP Boot   86  NTFS volume <span class="hljs-built_in">set</span> da  Non-FS data    <br>  6  FAT16           42  SFS             87  NTFS volume <span class="hljs-built_in">set</span> db  CP/M / CTOS / .<br>  7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility   <br>  8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       <span class="hljs-built_in">df</span>  BootIt         <br>  9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access     <br>  a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O        <br>  b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor      <br>  c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs        <br>  e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT            <br>  f  W95 Ext<span class="hljs-string">&#x27;d (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/</span><br><span class="hljs-string"> 10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b</span><br><span class="hljs-string"> 11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor      </span><br><span class="hljs-string"> 12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor      </span><br><span class="hljs-string"> 14  Hidden FAT16 &lt;3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary  </span><br><span class="hljs-string"> 16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS    </span><br><span class="hljs-string"> 17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE </span><br><span class="hljs-string"> 18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto</span><br><span class="hljs-string"> 1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep        </span><br><span class="hljs-string"> 1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT            </span><br><span class="hljs-string"> 1e  Hidden W95 FAT1 80  Old Minix      </span><br><span class="hljs-string"> Hex code (type L to list all codes): 8e         #选择8e</span><br><span class="hljs-string"> Changed type of partition &#x27;</span>Linux<span class="hljs-string">&#x27; to &#x27;</span>Linux LVM<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">Command (m for help): w               # 保存</span><br><span class="hljs-string"> The partition table has been altered!</span><br><span class="hljs-string"></span><br><span class="hljs-string">Calling ioctl() to re-read partition table.</span><br><span class="hljs-string"> Syncing disks.</span><br><span class="hljs-string"> [root@masterdb ~]#</span><br></code></pre></td></tr></table></figure><p>按照上面的过程，修改分区2，最终结果如下：</p><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/823295/202005/823295-20200513231717369-997595744.png"><img src="https://cdn.jsdelivr.net/gh/hswsp/IMAGE_HOST@main/img/823295-20200513231717728-1202598541.png" srcset="/img/loading.gif" lazyload alt="image"></a></p><p>接着进行创建物理卷(PV)即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@masterdb ~]<span class="hljs-comment"># pvcreate /dev/sdc1 </span><br>  Physical volume <span class="hljs-string">&quot;/dev/sdc1&quot;</span> successfully created.<br>[root@masterdb ~]<span class="hljs-comment"># pvcreate /dev/sdc2 </span><br>  Physical volume <span class="hljs-string">&quot;/dev/sdc2&quot;</span> successfully created.<br></code></pre></td></tr></table></figure><h1 id="创建扩容卷组"><strong>创建、扩容卷组</strong></h1><h2 id="创建卷组"><strong>创建卷组</strong></h2><p>有了PV就可以创建卷组了，创建卷组相关命令有：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用vgcreate创建卷组</span><br>vgcreate VG_NAME device1 ... devicen<br><br><span class="hljs-comment"># 使用vgdosplay、vgscan、vgs命令查看卷组</span><br>vgdisplay<br>vgscan<br>vgs<br></code></pre></td></tr></table></figure><p>接下来演示使用sdb和sdc1创建一个卷组VG_TEST。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用vgcreate创建卷组VG_TEST,包含物理卷：/dev/sdb和/dev/sdc1</span><br>[root@masterdb ~]<span class="hljs-comment"># vgcreate VG_TEST /dev/sdb /dev/sdc1</span><br>  Volume group <span class="hljs-string">&quot;VG_TEST&quot;</span> successfully created<br><br><span class="hljs-comment"># 查看方法一：使用vgdisplay查看卷组信息</span><br>[root@masterdb ~]<span class="hljs-comment"># vgdisplay</span><br>  --- Volume group ---<br>  VG Name               VG_TEST<br>  System ID             <br>  Format                lvm2<br>  Metadata Areas        2<br>  Metadata Sequence No  1<br>  VG Access             <span class="hljs-built_in">read</span>/write<br>  VG Status             resizable<br>  MAX LV                0<br>  Cur LV                0<br>  Open LV               0<br>  Max PV                0<br>  Cur PV                2<br>  Act PV                2<br>  VG Size               2.99 GiB<br>  PE Size               4.00 MiB<br>  Total PE              766<br>  Alloc PE / Size       0 / 0   <br>  Free  PE / Size       766 / 2.99 GiB<br>  VG UUID               DmY2Nz-ietc-2Y8Y-7A1b-1cpT-qEeV-XrgURn<br>...  <br>   <br><span class="hljs-comment"># 查看方法二：使用vgscan查看卷组信息</span><br>[root@masterdb ~]<span class="hljs-comment"># vgscan</span><br>  Reading volume <span class="hljs-built_in">groups</span> from cache.<br>  Found volume group <span class="hljs-string">&quot;VG_TEST&quot;</span> using metadata <span class="hljs-built_in">type</span> lvm2<br>  Found volume group <span class="hljs-string">&quot;centos&quot;</span> using metadata <span class="hljs-built_in">type</span> lvm2<br><br><span class="hljs-comment"># 查看方法三：使用vgs查看卷组信息</span><br>[root@masterdb ~]<span class="hljs-comment"># vgs </span><br>  VG      <span class="hljs-comment">#PV #LV #SN Attr   VSize  VFree</span><br>  VG_TEST   2   0   0 wz--n-  2.99g 2.99g<br>  centos    1   4   0 wz--n- 68.72g    0<br></code></pre></td></tr></table></figure><h2 id="扩容卷组">扩容卷组</h2><p>如果在使用过程中，发现要使用的空间大于卷组的空间，可以对卷组进行扩容，把新的物理卷(PV)加入到卷组中，语法为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vgextend VG_NAME device1 ... devicen<br></code></pre></td></tr></table></figure><p>接下来演示将sdc2加入到卷组VG_TEST中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用vgextend扩容卷组VG_TEST</span><br>[root@masterdb ~]<span class="hljs-comment"># vgextend VG_TEST /dev/sdc2  </span><br>  Volume group <span class="hljs-string">&quot;VG_TEST&quot;</span> successfully extended<br></code></pre></td></tr></table></figure><p>最终结果如下，发现PV数量和VG容量都发生了变化</p><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/823295/202005/823295-20200513231718058-1985120739.png"><img src="https://cdn.jsdelivr.net/gh/hswsp/IMAGE_HOST@main/img/823295-20200513231718445-783339278.png" srcset="/img/loading.gif" lazyload alt="image"></a></p><h1 id="创建扩容逻辑卷"><strong>创建、扩容逻辑卷</strong></h1><h2 id="创建逻辑卷"><strong>创建逻辑卷</strong></h2><p>有了卷组，就可以创建逻辑卷(LV)了，创建逻辑卷相关命令有：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用lvcreate创建逻辑卷</span><br>lvcreate –L SIZE –n LV_NAME VG_NAME<br><br>使用lvdisplay、lvscan、lvs查看逻辑卷<br>lvdisplay<br>lvscan<br>lvs<br></code></pre></td></tr></table></figure><p>接下来演示使用<code>VG_TEST</code>创建逻辑卷<code>lv_test</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用lvcreate创建逻辑卷lv_test</span><br>[root@masterdb ~]<span class="hljs-comment"># lvcreate -L 1g -n lv_test VG_TEST</span><br>  Logical volume <span class="hljs-string">&quot;lv_test&quot;</span> created.<br><br><span class="hljs-comment"># 查看方法一：使用lvdisplay查看逻辑卷</span><br>[root@masterdb ~]<span class="hljs-comment"># lvdisplay </span><br>  --- Logical volume ---<br>  LV Path                /dev/VG_TEST/lv_test<br>  LV Name                lv_test<br>  VG Name                VG_TEST<br>  LV UUID                RqWMOG-wCJJ-deu4-dIgv-c5hI-Bsqa-FHgh4E<br>  LV Write Access        <span class="hljs-built_in">read</span>/write<br>  LV Creation host, time masterdb, 2020-05-13 22:42:45 +0800<br>  LV Status              available<br>  <span class="hljs-comment"># open                 0</span><br>  LV Size                1.00 GiB<br>  Current LE             256<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently <span class="hljs-built_in">set</span> to     8192<br>  Block device           253:4<br>...<br>   <br><span class="hljs-comment"># 查看方法二：使用lvscan查看逻辑卷  </span><br>[root@masterdb ~]<span class="hljs-comment"># lvscan </span><br>  ACTIVE            <span class="hljs-string">&#x27;/dev/VG_TEST/lv_test&#x27;</span> [1.00 GiB] inherit<br>  ACTIVE            <span class="hljs-string">&#x27;/dev/centos/mysql&#x27;</span> [&lt;45.00 GiB] inherit<br>  ACTIVE            <span class="hljs-string">&#x27;/dev/centos/swap&#x27;</span> [&lt;3.73 GiB] inherit<br>  ACTIVE            <span class="hljs-string">&#x27;/dev/centos/home&#x27;</span> [10.00 GiB] inherit<br>  ACTIVE            <span class="hljs-string">&#x27;/dev/centos/root&#x27;</span> [10.00 GiB] inherit<br>  <br><span class="hljs-comment"># 查看方法三：使用lvs查看逻辑卷  </span><br>[root@masterdb ~]<span class="hljs-comment"># lvs </span><br>  LV      VG      Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  lv_test VG_TEST -wi-a-----   1.00g                                                    <br>  home    centos  -wi-ao----  10.00g                                                    <br>  mysql   centos  -wi-ao---- &lt;45.00g                                                    <br>  root    centos  -wi-ao----  10.00g                                                    <br>  swap    centos  -wi-ao----  &lt;3.73g<br></code></pre></td></tr></table></figure><p>创建完lv之后，格式化挂载即可使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建文件系统</span><br>[root@masterdb ~]<span class="hljs-comment"># mkfs.ext3 /dev/VG_TEST/lv_test </span><br>mke2fs 1.42.9 (28-Dec-2013)<br>Filesystem label=<br> OS <span class="hljs-built_in">type</span>: Linux<br>Block size=4096 (<span class="hljs-built_in">log</span>=2)<br>Fragment size=4096 (<span class="hljs-built_in">log</span>=2)<br> Stride=0 blocks, Stripe width=0 blocks<br> 65536 inodes, 262144 blocks<br> 13107 blocks (5.00%) reserved <span class="hljs-keyword">for</span> the super user<br> First data block=0<br> Maximum filesystem blocks=268435456<br> 8 block <span class="hljs-built_in">groups</span><br> 32768 blocks per group, 32768 fragments per group<br> 8192 inodes per group<br> Superblock backups stored on blocks: <br>     32768, 98304, 163840, 229376<br><br>Allocating group tables: <span class="hljs-keyword">done</span>                            <br> Writing inode tables: <span class="hljs-keyword">done</span>                            <br> Creating journal (8192 blocks): <span class="hljs-keyword">done</span><br> Writing superblocks and filesystem accounting information: <span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># 创建挂载点</span><br>[root@masterdb ~]<span class="hljs-comment"># mkdir /test </span><br><br><span class="hljs-comment"># 挂载文件系统</span><br>[root@masterdb ~]<span class="hljs-comment"># mount /dev/VG_TEST/lv_test /test</span><br><br><span class="hljs-comment"># 确认结果</span><br>[root@masterdb ~]<span class="hljs-comment"># df –h </span><br> Filesystem                   Size  Used Avail Use% Mounted on<br> /dev/mapper/centos-root       10G  4.1G  5.9G  42% /<br> ...<br> /dev/mapper/VG_TEST-lv_test  976M  1.3M  924M   1% /test<br></code></pre></td></tr></table></figure><h2 id="扩容逻辑卷"><strong>扩容逻辑卷</strong></h2><p>使用如下命令进行扩容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用lvextend扩容lv，+SIZE代表增加的空间</span><br>lvextend -L +SIZE lv_device<br><br><span class="hljs-comment"># 调整文件系统的大小</span><br>resize2fs device lv_device<br></code></pre></td></tr></table></figure><p>接下来演示使用对逻辑卷lv_test扩容500M。</p><p>扩容前文件磁盘大小如下：</p><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/823295/202005/823295-20200513231718812-1860533846.png"><img src="https://img2020.cnblogs.com/blog/823295/202005/823295-20200513231719174-88647049.png" srcset="/img/loading.gif" lazyload alt="image"></a></p><p>进行扩容操作：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 对lv进行扩容，增加500M空间</span><br>[root@masterdb ~]<span class="hljs-comment"># lvextend -L +500M /dev/VG_TEST/lv_test </span><br>  Size of logical <span class="hljs-keyword">volume</span><span class="language-bash"> VG_TEST/lv_test changed from 1.00 GiB (256 extents) to &lt;1.49 GiB (381 extents).</span><br>  Logical <span class="hljs-keyword">volume</span><span class="language-bash"> VG_TEST/lv_test successfully resized.</span><br></code></pre></td></tr></table></figure><p>之后查看磁盘大小，未发生改变：</p><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/823295/202005/823295-20200513231719520-1867843347.png"><img src="https://img2020.cnblogs.com/blog/823295/202005/823295-20200513231719884-1598548425.png" srcset="/img/loading.gif" lazyload alt="image"></a></p><p>调整文件系统的大小：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用resize2fs调整文件系统的大小</span><br>[root@masterdb ~]<span class="hljs-comment"># resize2fs /dev/VG_TEST/lv_test </span><br>resize2fs 1.42.9 (28-Dec-2013)<br>Filesystem at /dev/VG_TEST/lv_test is mounted on /test; on-line resizing required<br>old_desc_blocks = 1, new_desc_blocks = 1<br>The filesystem on /dev/VG_TEST/lv_test is now 390144 blocks long.<br></code></pre></td></tr></table></figure><p>确认磁盘大小已经发生了改变</p><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/823295/202005/823295-20200513231720209-2045634523.png"><img src="https://cdn.jsdelivr.net/gh/hswsp/IMAGE_HOST@main/img/823295-20200513231720555-1199395255.png" srcset="/img/loading.gif" lazyload alt="image"></a></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Operating-System/" class="category-chain-item">Operating System</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Operating-System/">#Operating System</a></div></div><div class="license-box my-3"><div class="license-title"><div>Linux 物理卷(PV)、逻辑卷(LV)、卷组(VG)管理</div><div>https://umnchampagne.top/2023/02/05/Linux volume/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>Starry</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>February 5, 2023</div></div><div class="license-meta-item"><div>Licensed under</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/02/16/Basic-Paxos/" title="Single-Decree Paxos"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Single-Decree Paxos</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/2023/01/20/git-merge/" title="Git Merge的三种操作"><span class="hidden-mobile">Git Merge的三种操作</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script type="text/javascript">var disqus_config=function(){this.page.url="https://umnchampagne.top/2023/02/05/Linux%20volume/",this.page.identifier="/2023/02/05/Linux%20volume/"};Fluid.utils.loadComments("#disqus_thread",(function(){var e=document,t=e.createElement("script");t.src="//fluid.disqus.com/embed.js",t.setAttribute("data-timestamp",new Date),(e.head||e.body).appendChild(t)}))</script><noscript>Please enable JavaScript to view the comments</noscript></div></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><script>Fluid.utils.createScript("https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js",(function(){mermaid.initialize({theme:"default"})}))</script><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">京ICP证123456号 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"> <span>京公网安备12345678号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-o}),t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),n=[];for(var i of o)n.push(".markdown-body > "+i.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/qipao.js"></script><script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/caidai.js"></script><script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/jingtaisidai.js"></script><script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiantiao.js"></script><script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiaoxuehua.js"></script><script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiaoxingxing.js"></script><script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/timeDate.js"></script><script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/love.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>